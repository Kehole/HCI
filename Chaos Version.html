<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pony Run: TOTAL SENSORY OVERLOAD (13s Cap)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Varela+Round&display=swap');

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #222; /* Darker bg to make flashes worse */
            font-family: 'Varela Round', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 400px;
            background: linear-gradient(to bottom, #00BFFF 0%, #87CEFA 50%, #90EE90 80%, #228B22 100%);
            border: 8px solid #FF00FF;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.8);
            overflow: hidden;
            cursor: pointer;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UI Styles */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200; /* Highest priority */
            visibility: hidden;
        }

        .modal {
            background: white;
            padding: 2rem;
            border: 5px solid red;
            text-align: center;
            box-shadow: 10px 10px 0px blue;
            font-family: 'Press Start 2P', cursive;
        }

        h1 { color: #FF00FF; margin-bottom: 1rem; line-height: 1.5; font-size: 20px; }
        p { color: #333; margin-bottom: 1.5rem; font-size: 12px; line-height: 1.5; }

        button {
            background: yellow;
            color: black;
            border: 4px solid black;
            padding: 15px 30px;
            font-size: 16px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            box-shadow: 5px 5px 0px black;
        }
        button:active { transform: translate(4px, 4px); box-shadow: 1px 1px 0px black; }

        #ui-start { visibility: visible; }

        #timer-hud {
            position: absolute;
            top: 10px; right: 10px;
            font-family: 'Press Start 2P', cursive;
            color: white;
            font-size: 16px;
            text-shadow: 2px 2px 0 #000;
            z-index: 150;
        }

        /* --- SKY CHAOS LAYER --- */
        #sky-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; 
            height: 240px; /* Safe zone limit (60% of 400px) */
            pointer-events: none;
            overflow: visible; /* Allow stacking */
            z-index: 50;
        }

        /* The Annoying Banner */
        #sky-banner {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            padding: 15px;
            background: red;
            border: 5px dashed yellow;
            color: yellow;
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
            text-shadow: 3px 3px 0 #000;
            box-shadow: 0 0 50px white;
            /* Constant annoying animation */
            animation: seizure 0.1s infinite, shake 0.2s infinite;
            display: none; /* Hidden at start */
        }

        @keyframes seizure {
            0% { background: red; color: yellow; border-color: blue; }
            25% { background: blue; color: white; border-color: red; }
            50% { background: lime; color: black; border-color: magenta; }
            75% { background: magenta; color: lime; border-color: cyan; }
            100% { background: yellow; color: red; border-color: black; }
        }

        @keyframes shake {
            0% { transform: translateX(-51%) rotate(-2deg); }
            50% { transform: translateX(-49%) rotate(2deg); }
            100% { transform: translateX(-50%) rotate(0deg); }
        }

        /* Screen Shake for the container */
        .screen-shake {
            animation: containerShake 0.2s infinite;
        }
        @keyframes containerShake {
            0% { transform: translate(2px, 2px); }
            25% { transform: translate(-2px, -2px); }
            50% { transform: translate(2px, -2px); }
            75% { transform: translate(-2px, 2px); }
            100% { transform: translate(0, 0); }
        }

        /* Flying Objects */
        .sky-object {
            position: absolute;
            animation: hoverJitter 0.5s infinite alternate;
        }

        @keyframes hoverJitter {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(10px) rotate(5deg); }
        }

        /* Lightning Flash */
        #flash-bang {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 180;
            mix-blend-mode: hard-light;
        }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="timer-hud">00.00s</div>

        <div id="sky-layer">
            <div id="sky-banner">
                <div id="banner-text">I AM THE CUTEST!</div>
            </div>
        </div>
        
        <div id="flash-bang"></div>

        <div id="ui-start" class="overlay">
            <div class="modal">
                <h1>ü¶Ñ SENSORY OVERLOAD</h1>
                <p>Speed Cap: 13s<br>Warning: Loud & Flashing</p>
                <button id="btn-start">I ACCEPT THE PAIN</button>
            </div>
        </div>

        <div id="ui-gameover" class="overlay">
            <div class="modal">
                <h1 style="color: red;">W A S T E D</h1>
                <p id="death-message">Too much noise?</p>
                <button id="btn-restart">SUFFER AGAIN</button>
            </div>
        </div>
    </div>

    <script>
        // --- ASSETS ---
        const ponySprite = new Image();
        ponySprite.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23FF69B4' d='M8 12h4v4h4v-4h4v4h4v8h-4v4h-4v-4h-4v4h-4v-4h-4z'/%3E%3Cpath fill='%23FF1493' d='M20 12h4v4h-4zM8 16h4v4h-4z'/%3E%3Cpath fill='%23000' d='M22 14h2v2h-2z'/%3E%3Cpath fill='%23800080' d='M24 10h4v6h-4zM4 18h4v4h-4z'/%3E%3C/svg%3E";

        const obstacleSprite = new Image();
        obstacleSprite.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23228B22' d='M12 28h8v-16h-4v4h-4z'/%3E%3Cpath fill='%23006400' d='M8 20h4v4h-4zM20 16h4v4h-4z'/%3E%3C/svg%3E";

        // Chaos Assets
        const dragonSVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Cpath fill='%23008080' d='M80 30c0-10 10-10 15-5s-5 15-10 15c-10 0-20-10-30-5s-10 15-20 10-20-10-25-10c-5 0-10 5-10 10s5 10 10 5 15-10 25-5 15 10 25 5 15-10 20-5z'/%3E%3Ccircle cx='85' cy='28' r='2' fill='yellow'/%3E%3Cpath stroke='red' d='M88 32l5 5' stroke-width='3'/%3E%3Cpath fill='none' stroke='orange' stroke-width='2' d='M20 30 Q 10 20 0 30'/%3E%3C/svg%3E";
        
        const ufoSVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23999' d='M8 14h16v4H8z'/%3E%3Cpath fill='%23555' d='M12 10h8v4h-8z'/%3E%3Ccircle cx='6' cy='18' r='3' fill='%230f0'/%3E%3Ccircle cx='26' cy='18' r='3' fill='%230f0'/%3E%3Ccircle cx='16' cy='18' r='3' fill='%230f0'/%3E%3Cpath stroke='%230f0' d='M16 20l-10 20M16 20l10 20M16 20v20' stroke-width='2'/%3E%3C/svg%3E";
        
        const cannonSVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23333' d='M4 20h20v6H4z'/%3E%3Ccircle cx='10' cy='26' r='4' fill='%23654321'/%3E%3Cpath fill='black' d='M24 20h4v6h-4z'/%3E%3Ctext x='0' y='15' font-size='10' fill='red' font-weight='bold'%3EBOOM%3C/text%3E%3C/svg%3E";
        
        const whaleSVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cpath fill='%2300008B' d='M10 40q10-20 40-10t10 20H10z'/%3E%3Ccircle cx='20' cy='38' r='2' fill='white'/%3E%3Cpath stroke='%2300FFFF' d='M25 30l-10-20M25 30l0-25M25 30l10-20' stroke-width='3'/%3E%3C/svg%3E";
        
        const oldManSVG = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='12' fill='%23FFDAB9'/%3E%3Crect x='10' y='14' width='12' height='4' fill='white'/%3E%3Ctext x='0' y='8' font-size='10' fill='gold' font-weight='bold' stroke='black' stroke-width='0.5'%3EEUREKA!%3C/text%3E%3C/svg%3E";

        // --- AUDIO SYSTEM ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx, isMuted = false;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        // Basic tones
        function playTone(freq, type, duration, vol=0.1, ramp='exp') {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            if (ramp === 'exp') {
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            } else {
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration);
            }
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function playJumpSound() { playTone(400, 'square', 0.1); }
        function playGameOverSound() { playTone(150, 'sawtooth', 0.5, 0.3); }

        // --- ANNOYING SFX LIBRARY ---
        
        // Dragon: Continuous roaring loop mechanism
        let dragonRoarInterval;
        function startDragonRoar() {
            if(dragonRoarInterval) return;
            // Play initial
            playDragonGrowl();
            // Loop every 2s
            dragonRoarInterval = setInterval(playDragonGrowl, 2000);
        }
        function playDragonGrowl() {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            // Deep rising growl
            osc.frequency.setValueAtTime(50, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 1.8);
            
            // LFO for Tremolo effect
            const lfo = audioCtx.createOscillator();
            lfo.type = 'sine';
            lfo.frequency.value = 15; // 15Hz rumble
            const lfoGain = audioCtx.createGain();
            lfoGain.gain.value = 500;
            lfo.connect(lfoGain);
            lfoGain.connect(osc.frequency);
            lfo.start();

            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2.0);
            
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 2.0);
            lfo.stop(audioCtx.currentTime + 2.0);
        }

        // UFO: Laser
        function playLaser() {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(2000, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3); 
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }

        // Cannon: Boom
        function playBoom() {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(60, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        }

        // Whale: Slide whistle
        function playSplash() {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.5); // Slide up
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.6);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.6);
        }

        // Old Man: 8-bit speech-like
        function playEureka() {
            if (!audioCtx || isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.setValueAtTime(1200, audioCtx.currentTime + 0.1);
            osc.frequency.setValueAtTime(1600, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.4);
        }

        // Thunder
        function playThunder() {
            if (!audioCtx || isMuted) return;
            const bufferSize = audioCtx.sampleRate * 0.5;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.8, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            noise.connect(gain); gain.connect(audioCtx.destination);
            noise.start();
        }

        // BGM
        let nextNoteTime = 0, bgmTimer, noteIndex = 0;
        const melody = [330, 330, 392, 440, 330, 294, 262, 294];
        function startBGM() {
            if (!audioCtx) return;
            stopBGM();
            nextNoteTime = audioCtx.currentTime;
            scheduleNote();
        }
        function scheduleNote() {
            if (isMuted) return;
            const bps = 0.2;
            const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.value = melody[noteIndex % melody.length];
            gain.gain.setValueAtTime(0.05, nextNoteTime);
            gain.gain.exponentialRampToValueAtTime(0.001, nextNoteTime + 0.15);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(nextNoteTime); osc.stop(nextNoteTime + 0.2);
            noteIndex++;
            nextNoteTime += bps;
            bgmTimer = setTimeout(scheduleNote, (bps * 1000) - 50);
        }
        function stopBGM() { clearTimeout(bgmTimer); }

        // --- GAME ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timerHud = document.getElementById('timer-hud');
        const gameContainer = document.getElementById('game-container');

        let gameState = 'START';
        let lastTime = 0, elapsedTime = 0, spawnTimer = 0;

        const GRAVITY = 1800;
        const JUMP_FORCE = -750;
        const GROUND_Y = 320;
        const BASE_SPEED = 300;
        const MAX_SPEED = 1200;
        const SPEED_CAP_MS = 13000; // 13s Cap

        let pony = { x: 50, y: GROUND_Y, width: 60, height: 60, dy: 0, grounded: true };
        let obstacles = [];

        // Chaos State
        let lastBannerBlock = 0;
        let dragonSpawned = false;
        let nextCreatureTime = 0;

        // DOM
        const uiStart = document.getElementById('ui-start');
        const uiGameOver = document.getElementById('ui-gameover');
        const skyLayer = document.getElementById('sky-layer');
        const banner = document.getElementById('sky-banner');
        const bannerText = document.getElementById('banner-text');
        const flash = document.getElementById('flash-bang');

        const narcissistQuotes = [
            "YOU ARE NOT CUTE!",
            "I AM THE MAIN CHARACTER!",
            "LOOK AT MY PIXELS!",
            "PATHETIC JUMPING!",
            "WHY ARE YOU TRYING?",
            "BOW DOWN TO ME!",
            "MY TEXTURE IS 4K!",
            "DELETE SYSTEM32!",
            "ERROR: SKILL NOT FOUND",
            "I AM GOD PONY!"
        ];

        function resetGame() {
            pony.y = GROUND_Y - pony.height;
            pony.dy = 0;
            pony.grounded = true;
            obstacles = [];
            elapsedTime = 0;
            spawnTimer = 0;
            lastBannerBlock = 0;
            dragonSpawned = false;
            nextCreatureTime = 23500;
            
            // Clean Sky but KEEP Banner
            const skyObjects = document.querySelectorAll('.sky-object');
            skyObjects.forEach(el => el.remove());
            
            banner.style.display = 'none';
            gameContainer.classList.remove('screen-shake');
            clearInterval(dragonRoarInterval);
            dragonRoarInterval = null;

            gameState = 'PLAYING';
            lastTime = performance.now();

            uiStart.style.visibility = 'hidden';
            uiGameOver.style.visibility = 'hidden';

            initAudio();
            startBGM();
            requestAnimationFrame(gameLoop);
        }

        function gameLoop(timestamp) {
            if (gameState !== 'PLAYING') return;

            const dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            if (dt > 0.1) { requestAnimationFrame(gameLoop); return; }

            elapsedTime += dt * 1000;
            timerHud.textContent = (elapsedTime / 1000).toFixed(2) + 's';

            // Speed Cap 13s
            const cappedTime = Math.min(elapsedTime, SPEED_CAP_MS);
            const progress = cappedTime / 20000; 
            const currentSpeed = BASE_SPEED + (MAX_SPEED - BASE_SPEED) * progress;

            // Physics
            pony.dy += GRAVITY * dt;
            pony.y += pony.dy * dt;
            if (pony.y > GROUND_Y - pony.height) {
                pony.y = GROUND_Y - pony.height;
                pony.dy = 0;
                pony.grounded = true;
            }

            // Obstacles
            spawnTimer -= dt;
            if (spawnTimer <= 0) {
                obstacles.push({ x: canvas.width, y: GROUND_Y - 50, width: 40, height: 50 });
                const minSpawn = 1.5 - (progress * 1.0);
                spawnTimer = minSpawn + Math.random() * 0.5;
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.x -= currentSpeed * dt;
                if (
                    pony.x + 10 < obs.x + obs.width &&
                    pony.x + pony.width - 10 > obs.x &&
                    pony.y + 10 < obs.y + obs.height &&
                    pony.y + pony.height > obs.y
                ) {
                    doGameOver();
                    return;
                }
                if (obs.x + obs.width < 0) obstacles.splice(i, 1);
            }

            // --- CHAOS LOGIC ---

            // 1. Banner: Starts at 10s, Refreshes every 10s (10, 20, 30...)
            if (elapsedTime >= 10000) {
                const currentBlock = Math.floor(elapsedTime / 10000);
                if (currentBlock > lastBannerBlock) {
                    lastBannerBlock = currentBlock;
                    updateBanner();
                }
                // Ensure visibility after 10s
                if (banner.style.display === 'none') {
                    updateBanner();
                    banner.style.display = 'block';
                }
            }

            // 2. Dragon at 20s
            if (elapsedTime >= 20000 && !dragonSpawned) {
                spawnDragon();
                dragonSpawned = true;
                startDragonRoar(); // Start the noise loop
            }

            // 3. Creatures every 3.5s after 20s
            if (elapsedTime >= 20000 && elapsedTime >= nextCreatureTime) {
                spawnRandomCreature();
                nextCreatureTime = elapsedTime + 3500;
            }

            // Draw
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, GROUND_Y, canvas.width, canvas.height - GROUND_Y);
            ctx.drawImage(ponySprite, pony.x, pony.y, pony.width, pony.height);
            obstacles.forEach(obs => {
                ctx.drawImage(obstacleSprite, obs.x, obs.y, obs.width, obs.height);
            });

            requestAnimationFrame(gameLoop);
        }

        // --- FX FUNCTIONS ---

        function updateBanner() {
            // Flash BG
            flash.style.opacity = 0.8;
            setTimeout(() => { flash.style.opacity = 0; }, 150);
            
            // Screen Shake trigger
            gameContainer.classList.add('screen-shake');
            setTimeout(() => gameContainer.classList.remove('screen-shake'), 500);

            playThunder();

            // Text
            const quote = narcissistQuotes[Math.floor(Math.random() * narcissistQuotes.length)];
            bannerText.innerHTML = `‚ö†Ô∏è ${quote} ‚ö†Ô∏è<br><span style="font-size:10px">(I am watching you)</span>`;
        }

        function spawnDragon() {
            const img = document.createElement('img');
            img.src = dragonSVG;
            img.className = 'sky-object';
            img.style.width = '250px';
            img.style.top = '20px';
            img.style.left = '800px'; // Start off screen
            img.style.transition = 'left 5s ease-out'; 
            skyLayer.appendChild(img);

            // Move in and stay
            setTimeout(() => { img.style.left = '500px'; }, 50);
        }

        function spawnRandomCreature() {
            const types = ['ufo', 'cannon', 'whale', 'oldman'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            const img = document.createElement('img');
            img.className = 'sky-object';
            img.style.width = '80px';
            
            // Random Height in Safe Zone (Top 0 to 200px max)
            const randomY = Math.random() * 180;
            img.style.top = randomY + 'px'; 
            img.style.left = '850px'; // Start right
            
            // Sound & Image
            if (type === 'ufo') { img.src = ufoSVG; playLaser(); }
            else if (type === 'cannon') { img.src = cannonSVG; playBoom(); }
            else if (type === 'whale') { img.src = whaleSVG; playSplash(); }
            else { img.src = oldManSVG; playEureka(); }

            skyLayer.appendChild(img);
            
            // Animate: Move to a random horizontal spot and STAY there
            const stopX = Math.random() * 600; // Anywhere in screen width
            
            // CSS transition for smooth entry
            img.style.transition = 'left 2s ease-out';
            setTimeout(() => { img.style.left = stopX + 'px'; }, 50);

            // NOTE: No remove() call. They pile up forever.
        }

        function jump() {
            if (gameState === 'PLAYING' && pony.grounded) {
                pony.dy = JUMP_FORCE;
                pony.grounded = false;
                playJumpSound();
            }
        }

        function doGameOver() {
            gameState = 'GAMEOVER';
            stopBGM();
            clearInterval(dragonRoarInterval);
            playGameOverSound();
            uiGameOver.style.visibility = 'visible';
        }

        document.getElementById('btn-start').addEventListener('click', resetGame);
        document.getElementById('btn-restart').addEventListener('click', resetGame);

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); jump(); }
        });
        document.getElementById('game-container').addEventListener('mousedown', (e) => {
            if (e.target.tagName !== 'BUTTON') jump();
        });
    </script>
</body>
</html>
